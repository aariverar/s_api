<!DOCTYPE html>
<html lang="en">
<head>
    <title id="title-report">Mi Banco Report</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="icon" href="icon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        .body {
            font-family: Arial, sans-serif;
            font-size: 14px;
            font-style: normal;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #101010;
        }

        .card-body-limited{
            max-width: 50px
        }

        .content-page{
            margin-top: 100px;
        }
        .navbar-text{
            font-size: 1.5em;
            font-weight: bold;
            color: #fff;
        }
        .text-link-navbar{
            font-size: 18px;
        }
        .nav-link{
            padding-right: 1.5rem !important;
        }
        .lead-duration {
            float: right;
            padding-right: 15px;
        }

        .collapsable-control {
            cursor: pointer;
        }

        .collapsed .chevron:after {
            content: "\f054";
        }
        .keyword {
            font-weight: bold;
        }
        .indention {
            padding-left: 3px;
        }
        .lead-duration {
            float: right;
            padding-right: 15px;
        }
        .description, .comment {
            font-style: italic;
            background-color: beige;
            white-space: pre;
        }
        .inner-level {
            margin-top: 5px;
            margin-left: 20px;
            padding-bottom: 2px;
            padding-left: 1px;
        }

        #feature-report{
            margin-top: 20px;
            margin-bottom: 20px;
            padding: 30px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #fdfdfd;
            justify-content: center;
        }
        #features-statistics-report > div{
            margin:20px 20px 30px 20px;
        }

        #features-statistics-report{
            margin-top: 20px;
            margin-bottom: 20px;
            background-color:  #fbf6f6f8;
        }

        #table-project{
        margin: 20px;
        }

        #table-report-status{
            width: 70% !important;
        }

        .statistics-feature-box{
            margin-left: 30px;
            margin-right: 30px;
        }

        .bg-passed{
            background-color:  rgba(75, 192, 120, 0.2) !important ;

        }

        .bg-failed{
        background-color: rgba(255, 99, 132, 0.2) !important ;

        }

        .bg-skipped{
            background-color: #ede9e9c5 !important ;
        }

        .chart-canvas-style{
            width: 300px;
            height: 300px;
            max-width: 35% !important;
            margin-left: 40px !important;
        }

        .scenario-box{
            margin: 30px;
            box-shadow: -1px 0 lightgray;
            transition: box-shadow 0.3s;
        }

        .steps-box{
            margin-top:20px;
            margin-left: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .step-box{
            margin-left: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .table-and-chart, .title-and-logo{
            margin-bottom: 30px;
        }

        .step-message{
            margin-bottom: 10px !important;
            padding: 10px !important;
        }

        .step-image-content{
            margin-bottom: 10px !important;
            padding: 10px !important;
            display: block;
            margin: auto;
            max-width: 100%;
        }

        #table-project{
            width: 60%;
        }
        .logo-mibanco{
            width: 40%;
        }

        .subtitles-text{
            color: #666666;
            box-sizing: border-box;
        }

        .card-body .rotate {
            z-index: 8;
            float: right;
            height: 100%;
        }
        .card-body .rotate i {
            position: absolute;
            left: 0;
            left: auto;
            right: -10px;
            bottom: 0;
            display: block;
            -webkit-transform: rotate(-44deg);
            -moz-transform: rotate(-44deg);
            -o-transform: rotate(-44deg);
            -ms-transform: rotate(-44deg);
            transform: rotate(-44deg);
            color:  rgba(201, 209, 208, 0.412);
        }

        #features-statistics-1 {
            height: 100%;
            width: 50%;
        }

        #features-statistics-2{
            width:35%;
            height: 100%;
        }

        #features-statistics-2 > div{
            width: 100%;
            height: 50%;
        }

        .assertions-card, #chart-scenarios-cards, #summary-widgets-features > div, #execution-time-cards > div{
            border: 2px solid #c8c6c6c5 !important;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15), inset 0 -1px 0 rgba(0, 0, 0, 0.15);
            border-radius: 10px !important;
        }

        #execution-time-cards > div{
            width: 48%;
            height: 120px;
        }

        #assertions-summary-cards > div{
            width: 100%;
        }

        .assertions-card, #chart-scenarios-cards{
            margin-bottom: 20px;
        }

        #chart-scenarios-cards{
            width: 100%;
            max-width: 380px !important;
            max-height: 380px !important;
            min-width: 200px !important;
        }
        #summary-widgets-features > div{
            width: 30%;
        }

        #assertions-summary-cards, #summary-widgets-features{
            width: 100%;
        }

        #features-dashboard{
            margin-bottom: 20px;
            background-color: #fbf6f6f8;
        }

        .assertions-card{
            height: 150px !important;
        }

        footer{
            background-color: #fbf6f6f8;
            border: 1px solid #e7e7e7a0;
            padding: 20px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark text-light bg-dark fixed-top" id="navigation">
        <div class="container-fluid">
            <p class="navbar-text navbar-left">Reporte de Automatización - SCB</p>
            <div id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a id ="navbar-features-link" class="nav-link text-link-navbar" href="overview-features.html">Features</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container content-page d-flex flex-column justify-content-center">
        <div class="element" style="margin-top: 20px;">
            <div class="d-flex flex-row justify-content-around title-and-logo">
                <div id="logo-mibanco">
                    <img src="logo_mibanco.png" height="90" onerror="this.style.display='none'">
                </div>
                <div id="table-project" class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">Equipo</th>
                                <th scope="col">Fecha del reporte</th>
                                <th scope="col">Duración ejecución</th>
                            </tr>
                        </thead>
                        <tbody class="table-group-divider">
                            <tr>
                                <td>Automatización SCB</td>
                                <td>{{date}}</td>
                                <td>{{took}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="element card" id="features-dashboard">
            <div id="features-statistics-report" class="card-body justify-content-center">
                <div class="d-flex flex-row justify-content-around align-items-center">
                    <div id="features-statistics-1" class="d-flex flex-column">
                        <div id="assertions-summary-cards d-flex flex-column">
                            <!-- <h1 class="text-center">Feature Stats</h1> -->
                            <!-- Row 1 -->
                            <div class="row">
                                <div class="col-lg-6 col-md-6">
                                    <div class="card assertions-card">
                                        <div class="card-body">
                                            <div class="rotate">
                                                <i class="fa fa-retweet fa-5x"></i>
                                            </div>
                                            <h6 class="subtitles-text">Total Iterations</h6>
                                            <h1 class="display-1 text-center">1</h1>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6">
                                    <div class="card assertions-card">
                                        <div class="card-body">
                                            <div class="rotate">
                                                <i class="fa fa-list fa-4x"></i>
                                            </div>
                                            <h6 class="subtitles-text">Total Passed Tests</h6>
                                            <h1 class="display-1 text-center">{{scenarios_information.total_scenarios_passed}}</h1>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                            <!-- Row 2 -->
                            <div class="row">
                                <div class="col-lg-6 col-md-6">
                                    <div class="card assertions-card">
                                        <div class="card-body">
                                            <div class="rotate">
                                                <i class="fa fa-plus-circle fa-5x"></i>
                                            </div>
                                            <h6 class="subtitles-text">Total Failed Tests</h6>
                                            <h1 class="display-1 text-center">{{scenarios_information.total_scenarios_failed}}</h1>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6">
                                    <div class="card assertions-card">
                                        <div class="card-body">
                                            <div class="rotate">
                                                <i class="fa fa-share fa-5x"></i>
                                            </div>
                                            <h6 class="subtitles-text">Total Skipped Tests</h6>
                                            <h1 class="display-1 text-center">{{scenarios_information.total_scenarios_skipped}}</h1>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="summary-widgets-features" class="d-flex flex-row justify-content-between align-items-center">
                            <div class="card"> 
                                <div class="card-body">
                                    <h6 class="subtitles-text">Features</h6>
                                    <h1 class="display-3 features-count text-center">{{total_features}}</h1>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="subtitles-text">Scenarios</h6>
                                    <h1 class="display-3 scenarios-count text-center">{{total_scenarios}}</h1>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="subtitles-text">Steps</h1>
                                    <h1 class="display-3 steps-count text-center">{{total_steps}}</h6>
                                </div>     
                            </div>
                        </div>
                    </div>
                    <div id="features-statistics-2" class="d-flex flex-column">
                        <div id="chart-scenarios-cards" class="justify-content-center align-items-center card">
                            <canvas class="chart-scenarios card-body"
                                    data-passed="{{ scenarios_information.total_scenarios_passed }}"
                                    data-failed="{{ scenarios_information.total_scenarios_failed }}"
                                    data-skipped="{{ scenarios_information.total_scenarios_skipped }}">
                            </canvas>
                        </div>
                        <div id="execution-time-cards" class="d-flex flex-row justify-content-between align-items-center">                    
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="subtitles-text">⏱️ Total run duration</h6>
                                    <h4 class="display-6 text-center">{{total_duration}}</h4>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="subtitles-text">⏱️ Average response time</h6>
                                    <h4 class="display-6 text-center">{{average_duration}}</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="justify-content-center d-flex flex-row justify-content-around align-items-center table-and-chart">
                    <div id="table-report-status" class="col align-items-center">
                        <table class = "table table-bordered align-items-center text-center table-light">
                            <thead>
                                <tr>
                                    <th scope="col"></th>
                                    <th scope="col" colspan="4">Scenarios</th>
                                    <th scope="col" colspan="4">Steps</th>                       
                                </tr>
                            </thead>  
                            <tbody>
                                <tr>
                                    <td>Features</td>
                                    <td class="text-dark fw-bold bg-passed">Passed</td>
                                    <td class="text-dark fw-bold bg-failed">Failed</td>
                                    <td class="text-dark fw-bold bg-skipped">Skipped</td>
                                    <td>Total</td>
                                    <td class="text-dark fw-bold bg-passed">Passed</td>
                                    <td class="text-dark fw-bold bg-failed">Failed</td>
                                    <td class="text-dark fw-bold bg-skipped">Skipped</td>
                                    <td>Total</td>
                                </tr>
                                {% for feature in features %} <!--Por cada feature-->
                                {% set feature_index = loop.index %}
                                    <tr>
                                        <td><a id="feature-text-{{feature_index}}" href="report-feature-{{feature_index}}.html">{{feature.feature_name }}</a> </td>
                                        <td>{{feature.scenario_passed_count}}</td>
                                        <td>{{feature.scenario_failed_count}}</td>
                                        <td>{{feature.scenario_skipped_count}}</td>
                                        <td>{{feature.scenarios_total}}</td>
                                        <td>{{feature.step_passed_count}}</td>
                                        <td>{{feature.step_failed_count}}</td>
                                        <td>{{feature.step_skipped_count}}</td>
                                        <td>{{feature.steps_total}}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>           
            </div>
        </div>
    </div>
    <footer class="footer">
        <div class="text-end">
            <span class="text-muted">Reporte HTML generado por SCB.</span>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            ['chart-scenarios', 'chart-steps'].forEach(function(className) {
                var canvases = document.getElementsByClassName(className);
                Array.prototype.forEach.call(canvases, function(canvas) {
                    var featurePassedCount = parseInt(canvas.getAttribute('data-passed'));
                    var featureFailedCount = parseInt(canvas.getAttribute('data-failed'));
                    var featureSkippedCount = parseInt(canvas.getAttribute('data-skipped'));
                    var featureName = canvas.getAttribute('data-feature-name');
                    var ctx = canvas.getContext('2d');
                    var data = [featurePassedCount, featureFailedCount, featureSkippedCount];
                    var myChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Passed', 'Failed', 'Skipped'],
                            datasets: [{
                                data: data,
                                backgroundColor: [
                                    'rgba(75, 192, 120, 0.2)',  // Color for 'Passed'
                                    'rgba(255, 99, 132, 0.2)',  // Color for 'Failed'
                                    '#ede9e9c5'  // Color for 'Skipped'
                                ],
                                borderColor: [
                                    'rgba(75, 192, 120, 0.245)',
                                    'rgba(255, 99, 133, 0.221)',
                                    '#c8c6c6c5'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'top',
                                },
                                title: {
                                    display: true,
                                    text: className === 'chart-scenarios' ? "Scenarios" : "Steps",
                                    font: {
                                        size: 20 
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            var label = context.label || '';
                                            var value = context.parsed;
                                            var total = context.dataset.data.reduce(function(a, b) {
                                                return a + b;
                                            }, 0);
                                            var percentage = ((value / total) * 100).toFixed(2);
                                            return label + ': ' + value + ' (' + percentage + '%)';
                                        }
                                    }
                                }
                            }
                        },
                    });
                });
            });
        });        
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>